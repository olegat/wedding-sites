<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>RSVP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      /* LANGUAGE HANDLING */
      span[lang] { display: none; }
      html[lang="en"] span[lang="en"],
      html[lang="es"] span[lang="es"],
      html[lang="fr"] span[lang="fr"] { display: inline; }

      body {
          font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
          max-width: 600px;
          margin: 2rem auto;
          padding: 0 1rem;
          line-height: 1.4;
      }

      label { display: block; margin-top: 1rem; font-weight: 600; }
      input[type="text"], input[type="email"], select, textarea, button {
          width: 100%;
          margin-top: 0.4rem;
          padding: 0.6rem;
          font-size: 1rem;
      }

      .radio-group { margin-top: 1rem; }
      .radio-group label { display: inline-block; margin-right: 1rem; font-weight: normal; }

      fieldset { margin-top: 1rem; margin-inline: 0; border: none; padding: 0; }
      legend { font-weight: 600; padding-inline: 0; }

      .hidden { display: none; }
      .success { font-weight: 600; color: #0a7a0a; margin-top: 2rem; }

      .disabled { opacity: 0.5; pointer-events: none; }
      .grid-two { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
      .placeholder { font-weight: normal; font-size: 0.9rem; color: #555; display: block; margin-top: 0.2rem; }

      .questioninfo {
          font-style: italic;
          font-weight: normal;
          font-size: 0.9em;
          color: #666;
          margin-top: 0.25rem;
          line-height: 1.4;
      }
    </style>
  </head>

  <body>
    <h1>
      <span lang="en">RSVP</span>
      <span lang="es">Confirmación</span>
      <span lang="fr">RSVP</span>
    </h1>

    <form id="rsvp-form" method="POST" action="https://getform.io/f/bdrkrodb">
      <!-- LANGUAGE SELECT -->
      <label>
        <span lang="en">Language</span>
        <span lang="es">Idioma</span>
        <span lang="fr">Langue</span>
        <select name="lang" id="lang-select">
          <option value="en">English</option>
          <option value="es">Español</option>
          <option value="fr">Français</option>
        </select>
      </label>

      <!-- NAME -->
      <label>
        <span lang="en">Name</span>
        <span lang="es">Nombre</span>
        <span lang="fr">Nom</span>
        <input name="name" type="text" required />
      </label>

      <!-- EMAIL -->
      <label>
        <span lang="en">Email</span>
        <span lang="es">Correo electrónico</span>
        <span lang="fr">E-mail</span>
        <div class="questioninfo">
          <span lang="en">We'll use this email address to send you updates.</span>
          <span lang="es">Usaremos esta dirección de correo para enviarle actualizaciones.</span>
          <span lang="fr">Nous utiliserons cette adresse e-mail pour vous envoyer des informations.</span>
        </div>
        <input name="email" type="email" required />
      </label>

      <!-- ATTENDING? RADIO -->
      <fieldset class="radio-group" id="attending-fieldset">
        <legend>
          <span lang="en">Attending?</span>
          <span lang="es">¿Asistirá?</span>
          <span lang="fr">Présence?</span>
        </legend>
        <label><input type="radio" name="attending" value="yes" required /> <span lang="en">Yes</span><span lang="es">Sí</span><span lang="fr">Oui</span></label>
        <label><input type="radio" name="attending" value="no" required /> <span lang="en">No</span><span lang="es">No</span><span lang="fr">Non</span></label>
      </fieldset>

      <!-- 1. +1 -->
      <fieldset class="radio-group" id="plus1-fieldset">
        <legend>
          <span lang="en">Will you be bringing a +1?</span>
          <span lang="es">¿Traerá acompañante?</span>
          <span lang="fr">Allez-vous venir avec un +1 ?</span>
        </legend>
        <label><input type="radio" name="plus1" value="yes" /> <span lang="en">Yes</span><span lang="es">Sí</span><span lang="fr">Oui</span></label>
        <label><input type="radio" name="plus1" value="no" /> <span lang="en">No</span><span lang="es">No</span><span lang="fr">Non</span></label>
      </fieldset>

      <!-- 2. +1 Name -->
      <label id="plus1-name-label">
        <span lang="en">+1 Name</span>
        <span lang="es">Nombre del acompañante</span>
        <span lang="fr">Nom du +1</span>
        <input name="plus1_name" type="text" disabled />
        <span class="placeholder" lang="en">Optional</span>
        <span class="placeholder" lang="es">Opcional</span>
        <span class="placeholder" lang="fr">Optionnel</span>
      </label>

      <!-- 3. Dietary & Alcohol -->
      <fieldset>
        <legend>
          <span lang="en">Dietary Requirements & Alcohol</span>
          <span lang="es">Requisitos alimentarios y alcohol</span>
          <span lang="fr">Régimes alimentaires et alcool</span>
        </legend>

        <div class="grid-two">
          <!-- Main Guest -->
          <div>
            <label>
              <span lang="en">Allergies</span>
              <span lang="es">Alergias</span>
              <span lang="fr">Allergies</span>
              <input name="allergies_main" type="text" />
              <span class="placeholder" lang="en">e.g. nuts, gluten</span>
              <span class="placeholder" lang="es">p.ej. nueces, gluten</span>
              <span class="placeholder" lang="fr">ex. noix, gluten</span>
            </label>

            <label>
              <span lang="en">Dietary choice</span>
              <span lang="es">Dieta</span>
              <span lang="fr">Régime</span>
              <input name="diet_main" type="text" />
              <span class="placeholder" lang="en">e.g. vegan, vegetarian</span>
              <span class="placeholder" lang="es">p.ej. vegano, vegetariano</span>
              <span class="placeholder" lang="fr">ex. végan, végétarien</span>
            </label>

            <fieldset class="radio-group">
              <legend>
                <span lang="en">Will you drink alcohol?</span>
                <span lang="es">¿Beberá alcohol?</span>
                <span lang="fr">Alcool ?</span>
              </legend>
              <label><input type="radio" name="alcohol_main" value="yes" /> <span lang="en">Yes</span><span lang="es">Sí</span><span lang="fr">Oui</span></label>
              <label><input type="radio" name="alcohol_main" value="no" /> <span lang="en">No</span><span lang="es">No</span><span lang="fr">Non</span></label>
            </fieldset>
          </div>

          <!-- +1 guest -->
          <div id="plus1-diet-column" class="disabled">
            <label>
              <span lang="en">+1 Allergies</span>
              <span lang="es">Alergias del acompañante</span>
              <span lang="fr">Allergies du +1</span>
              <input name="allergies_plus1" type="text" disabled />
              <span class="placeholder" lang="en">e.g. nuts, gluten</span>
              <span class="placeholder" lang="es">p.ej. nueces, gluten</span>
              <span class="placeholder" lang="fr">ex. noix, gluten</span>
            </label>

            <label>
              <span lang="en">+1 Dietary choice</span>
              <span lang="es">Dieta del acompañante</span>
              <span lang="fr">Régime du +1</span>
              <input name="diet_plus1" type="text" disabled />
              <span class="placeholder" lang="en">e.g. vegan, vegetarian</span>
              <span class="placeholder" lang="es">p.ej. vegano, vegetariano</span>
              <span class="placeholder" lang="fr">ex. végan, végétarien</span>
            </label>

            <fieldset class="radio-group">
              <legend>
                <span lang="en">+1 Will drink alcohol?</span>
                <span lang="es">El acompañante beberá alcohol?</span>
                <span lang="fr">+1 Alcool ?</span>
              </legend>
              <label><input type="radio" name="alcohol_plus1" value="yes" disabled /> <span lang="en">Yes</span><span lang="es">Sí</span><span lang="fr">Oui</span></label>
              <label><input type="radio" name="alcohol_plus1" value="no" disabled /> <span lang="en">No</span><span lang="es">No</span><span lang="fr">Non</span></label>
            </fieldset>
          </div>
        </div>
      </fieldset>

      <!-- 4. Preboda -->
      <fieldset class="radio-group">
        <legend>
          <span lang="en">Do you plan on joining the "preboda"?</span>
          <span lang="es">¿Planea asistir a la "preboda"?</span>
          <span lang="fr">Prévoit de rejoindre la "preboda" ?</span>
        </legend>
        <div class="questioninfo">
          <span lang="en">
            This is a casual and informal gathering the day before the wedding.
            It's a great opportunity to mingle with other guests beforehand.
          </span>
          <span lang="es">
            Es un encuentro informal y distendido el día antes de la boda.
            Es una excelente oportunidad para conocer a otros invitados con antelación.
          </span>
          <span lang="fr">
            Il s'agit d'une rencontre informelle et conviviale la veille du mariage.
            C'est une excellente occasion de faire connaissance avec les autres invités à l'avance.
          </span>
        </div>
        <label><input type="radio" name="preboda" value="yes" /> <span lang="en">Yes</span><span lang="es">Sí</span><span lang="fr">Oui</span></label>
        <label><input type="radio" name="preboda" value="no" /> <span lang="en">No</span><span lang="es">No</span><span lang="fr">Non</span></label>
        <label><input type="radio" name="preboda" value="maybe" /> <span lang="en">Maybe</span><span lang="es">Tal vez</span><span lang="fr">Peut-être</span></label>
      </fieldset>

      <!-- 5. Anything else -->
      <label>
        <span lang="en">Anything else we should know?</span>
        <span lang="es">¿Algo más que debamos saber?</span>
        <span lang="fr">Autre chose à signaler ?</span>
        <textarea name="notes" rows="4"></textarea>
        <span class="placeholder" lang="en">Optional</span>
        <span class="placeholder" lang="es">Opcional</span>
        <span class="placeholder" lang="fr">Optionnel</span>
      </label>

      <!-- Hidden metadata -->
      <input type="hidden" name="source" value="rsvp-test" />

      <button type="submit">
        <span lang="en">Submit</span>
        <span lang="es">Enviar</span>
        <span lang="fr">Envoyer</span>
      </button>
    </form>

    <div id="success" class="success hidden">
      <span lang="en">Thanks! Your response has been recorded.</span>
      <span lang="es">¡Gracias! Su respuesta ha sido registrada.</span>
      <span lang="fr">Merci ! Votre réponse a été enregistrée.</span>
    </div>

    <script>
      const fakeGetformio = true;
      const form = document.getElementById("rsvp-form");
      const success = document.getElementById("success");
      const langSelect = document.getElementById("lang-select");

      const attendingRadios = document.querySelectorAll('input[name="attending"]');
      const plus1Radios = document.querySelectorAll('input[name="plus1"]');
      const plus1NameInput = document.querySelector('input[name="plus1_name"]');
      const plus1DietColumn = document.getElementById('plus1-diet-column');

      // Initialize language
      let currentLang = localStorage.getItem('lang') || 'en';
      langSelect.value = currentLang;
      document.documentElement.lang = currentLang;

      langSelect.addEventListener("change", e => {
        currentLang = e.target.value;
        localStorage.setItem('lang', currentLang);
        document.documentElement.lang = currentLang;
      });

      // Function to enable/disable +1 fields
      function updatePlus1Fields() {
        const plus1Yes = document.querySelector('input[name="plus1"]:checked')?.value === 'yes';
        plus1NameInput.disabled = !plus1Yes;
        plus1DietColumn.classList.toggle('disabled', !plus1Yes);
        plus1DietColumn.querySelectorAll('input[type="text"], input[type="radio"]').forEach(el => el.disabled = !plus1Yes);
      }

      plus1Radios.forEach(r => r.addEventListener('change', updatePlus1Fields));

      // Function to disable all fields if not attending
      function updateAttendingFields() {
        const attendingYes = document.querySelector('input[name="attending"]:checked')?.value === 'yes';

        // All relevant elements
        const allEls = form.querySelectorAll('input, select, textarea, fieldset, label, .placeholder');
        allEls.forEach(el => {
          if (!['lang', 'attending'].includes(el.name) && el.id !== 'attending-fieldset') {
            el.disabled = !attendingYes;
            if ((el.tagName === 'LABEL' && el.id === 'plus1-name-label') || el.classList.contains('placeholder')) {
              el.classList.toggle('disabled', !attendingYes);
            }
            const closestFieldset = el.closest('fieldset');
            if (closestFieldset && closestFieldset.id !== 'attending-fieldset') {
              closestFieldset.classList.toggle('disabled', !attendingYes);
            }
          }
        });
      }

      attendingRadios.forEach(r => r.addEventListener('change', () => {
        updateAttendingFields();
        updatePlus1Fields();
      }));

      // Form submit
      form.addEventListener('submit', async e => {
        e.preventDefault();

        if (fakeGetformio) {
          form.classList.add('hidden');
          success.classList.remove('hidden');
          return;
        }

        const formData = new FormData(form);
        try {
          const res = await fetch(form.action, { method:'POST', body: formData });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          form.classList.add('hidden');
          success.classList.remove('hidden');
        } catch(err) {
          console.error(err);
          alert('Submission failed. Please try again.');
        }
      });

      // Initialize state
      updateAttendingFields();
      updatePlus1Fields();
    </script>
  </body>
</html>
